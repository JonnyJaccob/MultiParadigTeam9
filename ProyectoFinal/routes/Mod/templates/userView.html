<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista previa usuario</title>
</head>
<body>
    <h1>Vista Previa</h1>
    <h2 id="hname">Estas viendo a: Usuario</h2>
    <h2>Documentos</h2>
    <div id="documentos-container">
        <div class="documento">
            <input type="checkbox" id="chkacta" readonly>
            <label for="acta">Acta de Nacimiento</label>
            <button onclick="subirDocumento('acta')">Subir Documento</button>
            <button onclick="verDocumento('acta')">Ver Documento</button>
        </div>

        <div class="documento">
            <input type="checkbox" id="chkdomicilio" readonly>
            <label for="domicilio">Comprobante de Domicilio</label>
            <button onclick="subirDocumento('domicilio')">Subir Documento</button>
            <button onclick="verDocumento('domicilio')">Ver Documento</button>
        </div>

        <div class="documento">
            <input type="checkbox" id="chkine" readonly>
            <label for="ine">Documento INE</label>
            <button onclick="subirDocumento('ine')">Subir Documento</button>
            <button onclick="verDocumento('ine')">Ver Documento</button>
        </div>

        <div class="documento">
            <input type="checkbox" id="chkpasaporte"  readonly>
            <label for="pasaporte">Documento Pasaporte</label>
            <button onclick="subirDocumento('pasaporte')">Subir Documento</button>
            <button onclick="verDocumento('pasaporte')">Ver Documento</button>
        </div>
    </div>
    <button onclick="window.location.href = '/mod/';"></button>

    <script>
        function Iniciar() {
            
            function obtenerDatos() {
                // Obtener el id de la cuenta del localStorage
                const cuenta_id = localStorage.getItem('cuenta_id');

                // Verificar si hay un id de cuenta antes de hacer la petición
                if (cuenta_id) {
                    // Configurar los datos para enviar en la petición
                    const datos = {
                        cuenta_id: cuenta_id,
                    };

                    // Configurar opciones de la petición
                    const opciones = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(datos),
                    };

                    // Hacer la petición al servidor
                    fetch('obtener_doc', opciones)
                        .then(response => response.json())
                        .then(data => {
                            //aqui va la info de doc
                            if (data.acta && data.acta.length > 0) {
                                const acta = data.acta[0];  // Tomar el primer documento de tipo "acta"
                                actainfo = acta.link;
                                document.getElementById('chkacta').checked = acta.isaprobado;
                            }
                            if (data.comprobante && data.comprobante.length > 0) {
                                const comprobante = data.comprobante[0];
                                comprobanteinfo = comprobante.link;
                                document.getElementById('chkdomicilio').checked = comprobante.isaprobado;
                            }
                            if (data.ine && data.ine.length > 0) {
                                const ine = data.ine[0];
                                ineinfo = ine.link;
                                document.getElementById('chkine').checked = ine.isaprobado;
                            }
                            if (data.pasaporte && data.pasaporte.length > 0) {
                                const pasaporte = data.pasaporte[0];
                                pasaporteinfo = pasaporte.link;
                                document.getElementById('chkpasaporte').checked = pasaporte.isaprobado;
                            }
                               
                        })
                        .catch(error => {
                            console.error('Error al obtener los datos:', error);
                        });
                    
                }else{

                }
            }
            // Llamar a la función para obtener y llenar los datos
            obtenerDatos();
            function subirDocumento(tipoDocumento) {
                // Aquí puedes implementar la lógica para abrir un menú o ventana de subida de documentos
                // y solicitar la autorización del usuario.
                console.log(`Subir documento de tipo ${tipoDocumento}`);
            }
        };
        window.onload = Iniciar;
        function verDocumento(tipoDocumento) {
            let documentoLink;
            let documentoAprobado;
            switch (tipoDocumento) {
                case 'acta':
                    documentoLink = actainfo;
                    documentoAprobado = document.getElementById('chkacta').checked;
                    break;
                case 'comprobante':
                    documentoLink = comprobanteinfo;
                    documentoAprobado = document.getElementById('chkdomicilio').checked;
                    break;
                case 'ine':
                    documentoLink = ineinfo;
                    documentoAprobado = document.getElementById('chkine').checked;
                    break;
                case 'pasaporte':
                    documentoLink = pasaporteinfo;
                    documentoAprobado = document.getElementById('chkpasaporte').checked;
                    break;
                default:
                    console.error('Tipo de documento no reconocido');
                    return;
            }
            // Verificar si hay un link para el documento
            if (documentoLink) {
                // Abrir el enlace en una nueva pestaña
                window.open(documentoLink, '_blank');
            } else {
                // Si no hay link, abrir un PDF predeterminado o manejarlo según tus necesidades
                console.log(`No hay link para el documento de tipo ${tipoDocumento}. Abriendo PDF predeterminado.`);
                
                // Aquí puedes abrir un PDF predeterminado o mostrar un mensaje al usuario
                // Ejemplo: Abrir un PDF predeterminado en blanco
                const urlPDF = 'obtener_pdf';
                window.open(urlPDF, '_blank');
                //window.location.href = urlPDF;
            }
        }
    </script>
</body>
</html>